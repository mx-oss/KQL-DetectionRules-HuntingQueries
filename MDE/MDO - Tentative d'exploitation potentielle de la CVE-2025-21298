//Cette alerte indique la détection de fichiers RTF malveillants exploitant la vulnérabilité CVE-2025-21298 sur des dispositifs vulnérables. La vulnérabilité permet l'exécution de code à distance via des fichiers RTF spécialement conçus, pouvant entraîner une compromission complète du système affecté.
//Risque Cyber
//La CVE-2025-21298 est une vulnérabilité critique d'exécution de code à distance dans Windows OLE, avec un score CVSS de 9.8. Elle permet à un attaquant de prendre le contrôle complet d'un système affecté en incitant l'utilisateur à ouvrir un fichier RTF malveillant. Les conséquences peuvent inclure l'installation de logiciels malveillants, le vol de données sensibles et la perturbation des opérations.
//Résumé de la CVE-2025-21298
//La CVE-2025-21298 affecte plusieurs versions de Windows, y compris Windows 10, 11, et diverses versions de Windows Server. La vulnérabilité réside dans la manière dont Windows OLE traite les fichiers RTF, permettant à un attaquant d'exécuter du code arbitraire à distance. Microsoft a publié des mises à jour de sécurité en janvier 2025 pour corriger cette vulnérabilité
//
// https://msrc.microsoft.com/update-guide/en-US/advisory/CVE-2025-21298
// Outlook utilise le format RTF (Rich Text Format) principalement pour les messages utilisant Microsoft Exchange. Ce format permet d'inclure des objets OLE (comme les documents Microsoft Office intégrés) dans les messages
//
let InboundRTF =
EmailAttachmentInfo
| where FileType == "rtf" // Filtrer les pièces jointes de type RTF
| join EmailEvents on NetworkMessageId // Joindre avec les événements d'email pour obtenir des informations supplémentaires
| where EmailDirection == "Inbound" and LatestDeliveryAction != "Blocked" // Ne considérer que les emails entrants non bloqués
| distinct FileName; // Obtenir une liste distincte des noms de fichiers
// Définir les points de terminaison vulnérables
let VulnerableEP =
DeviceTvmSoftwareVulnerabilities 
| where CveId == "CVE-2025-21298" // Filtrer les vulnérabilités spécifiques à CVE-2025-21298
| distinct DeviceName; // Obtenir une liste distincte des noms de dispositifs
// Détecter les événements de création de fichiers RTF
DeviceFileEvents 
| where ActionType == "FileCreated" and FileName endswith ".rtf" // Filtrer les événements de création de fichiers RTF
| where InitiatingProcessFileName == "outlook.exe" // Filtrer les événements initiés par Outlook
| where parse_json(AdditionalFields)["FileType"] == 'Rtf' // Vérifier que le type de fichier est bien RTF
| where FileName has_any(InboundRTF) and DeviceName has_any(VulnerableEP) // Vérifier si le fichier et le dispositif sont dans les listes définies précédemment

// La vulnérabilité CVE-2024-38100, connue sous le nom de "Windows File Explorer Elevation Of Privilege Vulnerability", est une faille de sécurité critique dans l'Explorateur de fichiers Windows. Cette vulnérabilité réside dans l'objet DCOM (Distributed Component Object Model) ShellWindows, identifié par le CLSID "9BA05972-F6A8-11CF-A442-00A0C90A8F39"
// L'identifiant "9BA05972-F6A8-11CF-A442-00A0C90A8F39" correspond à l'objet COM (Component Object Model) "ShellWindows" dans Windows. 
// Cet objet est utilisé par Internet Explorer et d'autres applications pour gérer les fenêtres du shell Windows
// Lorsque la ligne de commande d'un processus contient cet identifiant, cela signifie généralement que le processus interagit avec les fenêtres du shell Windows, souvent pour des tâches liées à l'affichage ou à la gestion des fenêtres de l'explorateur de fichiers.
// L'identifiant "9BA05972-F6A8-11CF-A442-00A0C90A8F39" est associé à l'objet COM ShellWindows, utilisé par l'Explorateur de fichiers Windows pour gérer les fenêtres du shell. La vulnérabilité permet aux attaquants d'exploiter des contrôles d'accès inadéquats lorsque l'Explorateur de fichiers s'exécute à un niveau d'intégrité élevé
//En utilisant l'activation de session croisée COM, les attaquants peuvent créer un objet ShellWindows dans une session élevée, comme celle d'un administrateur. Cela leur permet d'exécuter des commandes arbitraires ou de lancer des shells inversés en utilisant des méthodes comme ShellExecute1. L'exploitation de cette vulnérabilité peut conduire à : Un accès non autorisé à des fichiers sensibles, L'installation de logiciels malveillants, Une compromission complète du système
//
DeviceProcessEvents
| where ProcessCommandLine contains "9BA05972-F6A8-11CF-A442-00A0C90A8F39"
| join kind=inner ( DeviceInfo) on $left.DeviceId == $right.DeviceId
| where (OSDistribution has "WindowsServer2016" and OSBuild < 14393) or (OSDistribution has "WindowsServer2019" and OSBuild < 17763)
or (OSDistribution has "WindowsServer2022" and OSVersionInfo !contains "23H2" and OSBuild < 20348) or (OSDistribution has "WindowsServer2022" and OSVersionInfo contains "23H2" and OSBuild < 25398)
| distinct OSVersion,OSArchitecture, OSVersionInfo, OSDistribution, OSBuild ,ProcessCommandLine
//
// MITRE ATT&CK
// T1548.002: Bypass User Account Control - Cette technique est utilisée pour contourner les contrôles de compte utilisateur (UAC) et obtenir des privilèges élevés1.
// T1059.001: Command and Scripting Interpreter: PowerShell - Les attaquants peuvent utiliser PowerShell pour exécuter des commandes arbitraires1.
// T1059.003: Command and Scripting Interpreter: Windows Command Shell - Utilisation de la ligne de commande Windows pour exécuter des scripts ou des commandes1.
// T1078: Valid Accounts - Exploitation de comptes valides pour accéder au système avec des privilèges élevés
